from wrpsolver.bc.gym_env_hwc_100 import GridWorldEnv
import shapely
import cv2
import sys
import tty
import termios
import numpy as np
def readchar():
    fd = sys.stdin.fileno()
    old_settings = termios.tcgetattr(fd)
    try:
        tty.setraw(sys.stdin.fileno())
        ch = sys.stdin.read(1)
    finally:
        termios.tcsetattr(fd, termios.TCSADRAIN, old_settings)
    return ch
def key2move(key):
    actionDict = {'d':0,'a':1,'s':2,'w':3,'x':4,'q':5,'z':6,'e':7}
    return actionDict[key]
pointList = [[324, 6], [323, 6], [323, 228], [450, 228], [450, 161], [451, 160], [457, 160], [458, 161], [457, 161], [457, 162], [458, 163], [458, 228], [681, 228], [682, 229], [682, 235], [681, 236], [617, 236], [617, 276], [616, 277], [610, 277], [610, 276], [610, 236], [324, 236], [324, 386], [610, 386], [610, 340], [610, 340], [616, 340], [617, 340], [617, 633], [645, 633], [645, 633], [645, 640], [645, 640], [644, 640], [643, 640], [611, 640], [610, 639], [610, 393], [605, 393], [605, 393], [324, 393], [324, 673], [323, 674], [317, 674], [316, 673], [316, 562], [6, 562], [6, 563], [6, 861], [316, 861], [316, 750], [317, 749], [323, 749], [324, 750], [324, 862], [394, 862], [395, 863], [503, 863], [503, 863], [611, 863], [612, 864], [674, 864], [675, 863], [693, 863], [693, 864], [769, 864], [770, 865], [871, 865], [871, 865], [955, 865], [955, 640], [727, 640], [726, 640], [726, 633], [727, 633], [761, 633], [761, 575], [761, 575], [768, 575], [768, 575], [768, 633], [955, 633], [955, 493], [768, 493], [768, 511], [768, 512], [761, 512], [761, 511], [761, 426], [761, 425], [768, 425], [768, 426], [768, 486], [958, 486], [958, 141], [768, 141], [768, 362], [768, 363], [761, 363], [761, 362], [761, 236], [745, 236], [745, 235], [745, 229], [745, 228], [761, 228], [761, 134], [760, 133], [760, 6], [458, 6], [458, 113], [457, 114], [451, 114], [450, 113], [450, 6]]
actionList = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 7, 0, 7, 0, 7, 0, 4, 0, 0, 0, 0, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 5, 5, 3, 3, 3, 3, 3, 3, 3, 3, 7, 7, 7, 5, 5, 5, 5, 1, 1, 5, 1, 5, 1, 5, 1, 5, 5, 1, 5, 0, 7, 0, 7, 0, 7, 7, 7, 7, 3, 5, 5, 1, 1, 1, 1, 5, 1, 5, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1, 5, 5, 5, 1, 5, 1, 5]
startPoint = (31, 69)
# pointList = [[40, 1], [40, 1], [40, 61], [84, 61], [84, 60], [84, 60], [85, 60], [85, 60], [86, 60], [86, 60], [86, 61], [86, 61], [86, 61], [86, 70], [86, 70], [84, 70], [84, 70], [84, 62], [38, 62], [38, 63], [1, 63], [1, 63], [1, 149], [55, 149], [55, 120], [55, 120], [55, 91], [55, 91], [55, 90], [56, 89], [57, 89], [57, 89], [84, 89], [84, 81], [84, 81], [86, 81], [86, 81], [86, 91], [86, 91], [86, 91], [86, 91], [85, 91], [85, 109], [85, 109], [85, 127], [85, 127], [85, 134], [87, 134], [87, 134], [87, 136], [87, 136], [85, 136], [85, 164], [85, 164], [85, 196], [165, 196], [165, 136], [98, 136], [98, 136], [98, 134], [98, 134], [165, 134], [165, 134], [165, 129], [166, 129], [166, 122], [166, 122], [166, 115], [166, 115], [166, 108], [166, 108], [166, 101], [166, 101], [166, 94], [166, 94], [166, 87], [166, 87], [166, 80], [167, 80], [167, 73], [167, 73], [167, 66], [167, 66], [167, 59], [167, 59], [167, 57], [125, 57], [125, 57], [125, 55], [125, 55], [169, 55], [169, 55], [199, 55], [199, 1], [115, 1], [115, 48], [115, 48], [114, 48], [114, 48], [114, 1], [86, 1], [86, 14], [86, 14], [86, 37], [86, 37], [86, 49], [86, 49], [84, 49], [84, 49], [84, 41], [84, 41], [84, 1]]
# startPoint = (55, 65)
# actionList = [1,1,0,0,0, 0, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 4, 0, 0, 7, 7, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 7, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 7, 0, 0, 7, 7, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 6, 2, 6, 2, 6, 6, 2, 2, 2, 2, 6, 6, 6, 6, 2, 2, 2, 6, 2, 2, 2, 6, 6, 2, 6, 2, 6, 2, 6, 2, 6, 6, 2, 2, 6, 2, 2, 6, 2, 6, 2, 6, 2]
testList = []
def main():
    polygon = shapely.Polygon(pointList)
    gridEnv = GridWorldEnv()
    # gridEnv.reset(polygon,startPoint)
    gridEnv.reset()
    rewardSum = 0
    Done = False
    cnt = 0

    for action in actionList:
    # while not Done:
    #     key = readchar()
    #     action = key2move(key)
        testList.append(gridEnv.pos)
        _,reward,Done,_ = gridEnv.step(action)
        print(reward,cnt)
        rewardSum += reward
        cv2.imwrite('/remote-home/ums_qipeng/WatchRouteProblem/tmp/' + str(cnt) +'.png',gridEnv.image)
        cnt += 1

    print(rewardSum)
if __name__ == '__main__':
    while(True):
        main()
        break